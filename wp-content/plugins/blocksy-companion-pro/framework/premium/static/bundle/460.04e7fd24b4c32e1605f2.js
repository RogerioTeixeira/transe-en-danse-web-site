"use strict";(globalThis.webpackChunkblocksy_companion=globalThis.webpackChunkblocksy_companion||[]).push([[460],{460:function(e,t,o){o.d(t,{L:function(){return B},openMicroPopup:function(){return W}});var n=o(705),r=o(621),c=o.n(r),i=o(407);const s=["button:enabled:not([readonly])","select:enabled:not([readonly])","textarea:enabled:not([readonly])","input:enabled:not([readonly])","a[href]","area[href]","iframe","object","embed","[tabindex]","[contenteditable]","[autofocus]"];let a=null;const l=function(e){if(!a)return;const t=[...a.querySelectorAll(s.join(","))],o=t[0],n=t[t.length-1];"Tab"!==e.key&&9!==e.keyCode||(t.includes(document.activeElement)||(o.focus(),e.preventDefault()),e.shiftKey?document.activeElement===o&&(n.focus(),e.preventDefault()):document.activeElement===n&&(o.focus(),e.preventDefault()))},u=function(e){const t=e.querySelectorAll(s.join(","));0!==t.length&&(a||document.addEventListener("keydown",l),a=e,setTimeout(function(){t[0].focus()},50))},d=function(){a=null,document.removeEventListener("keydown",l)},f=function(){return window.ctFrontend&&window.ctFrontend.focusLockManager||(window.ctFrontend.focusLockManager={focusLockOn:u,focusLockOff:d}),window.ctFrontend.focusLockManager};var p=!1;if("undefined"!=typeof window){var m={get passive(){p=!0}};window.addEventListener("testPassive",null,m),window.removeEventListener("testPassive",null,m)}var y="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),g=[],v=!1,b=-1,w=void 0,h=void 0,k=function(e){return g.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},S=function(e){var t=e||window.event;return!!k(t.target)||(t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1))},O=function(){void 0!==h&&(document.body.style.paddingRight=h,h=void 0),void 0!==w&&(document.body.style.overflow=w,w=void 0)},L=function(e,t){if(e){if(!g.some(function(t){return t.targetElement===e})){var o={targetElement:e,options:t||{}};g=[].concat(function(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}(g),[o]),y?(e.ontouchstart=function(e){1===e.targetTouches.length&&(b=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var o=e.targetTouches[0].clientY-b;!k(e.target)&&(t&&0===t.scrollTop&&o>0||function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&o<0?S(e):e.stopPropagation())}(t,e)},v||(document.addEventListener("touchmove",S,p?{passive:!1}:void 0),v=!0)):function(e){if(void 0===h){var t=!!e&&!0===e.reserveScrollBarGap,o=window.innerWidth-document.documentElement.clientWidth;t&&o>0&&(h=document.body.style.paddingRight,document.body.style.paddingRight=o+"px")}void 0===w&&(w=document.body.style.overflow,document.body.style.overflow="hidden")}(t)}}else console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.")};const E="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1);var P=function(e){E?(y?(g.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),v&&(document.removeEventListener("touchmove",S,p?{passive:!1}:void 0),v=!1),b=-1):O(),g=[]):(document.body.style.overflow="",document.body.style.removeProperty("--scrollbar-width"))},j=function(e){if(E)e&&L(e,{allowTouchMove:function(e){return!!e.closest(".select2-container")}});else{let e=window.innerWidth-document.documentElement.clientWidth;e>0&&document.body.style.setProperty("--scrollbar-width",`${e}px`),document.body.style.overflow="hidden"}};const _=function(){return window.ctFrontend&&window.ctFrontend.scrollLockManager||(window.ctFrontend=window.ctFrontend||{},window.ctFrontend.scrollLockManager={enable:P,disable:j}),window.ctFrontend.scrollLockManager};var C=o(561),T=o.n(C);function D(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}const q=function(e,t={}){if(t=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?D(Object(o),!0).forEach(function(t){(0,n.A)(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):D(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({maybeCloseStrategies:{}},t),t.maybeCloseStrategies.button_click){const o=1e3*parseInt(t.maybeCloseStrategies.button_click.close_delay||0),n=t.maybeCloseStrategies.button_click.selector,r=e.querySelectorAll(n);r.length&&r.forEach(function(t){t.hasAdditionalCloseEvent||(t.hasAdditionalCloseEvent=!0,t.addEventListener("click",function(t){t.preventDefault(),B(e,{reason:"button_click",delay:o})}))})}if(t.maybeCloseStrategies.form_submit){const n=e.querySelector("form"),r=1e3*parseInt(t.maybeCloseStrategies.form_submit.close_delay||0);if(n&&!n.hasAdditionalCloseEvent)if(n.hasAdditionalCloseEvent=!0,window.document.body.addEventListener("kb-form-success",function(){B(e,{reason:"form_submit:kadence",delay:r})},!1),n.matches(".wpforms-form"))T()(n).on("wpformsAjaxSubmitSuccess",function(){B(e,{reason:"form_submit:wpforms",delay:r})});else if(n.matches("form.frm-fluent-form"))T()(n).on("fluentform_submission_success",function(t){B(e,{reason:"form_submit:fluentform",delay:r})});else if(n.matches(".gform_anchor")||n.querySelector('[class*="gform_"]')){var o=n.id;o=parseInt(o.replace(/\D/g,"")),jQuery(document).on("gform_confirmation_loaded",function(t,n){o===n&&B(e,{reason:"form_submit:gravityforms",delay:r})})}else n.querySelector('.ninja-forms-field[type="submit"]')?jQuery(document).on("nfFormSubmitResponse",function(t,{response:o}){o.errors.length||B(e,{reason:"form_submit:ninjaforms",delay:r})}):n.addEventListener("submit",function(t){t.preventDefault(),B(e,{reason:"form_submit:default",delay:r})})}};function A(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function M(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?A(Object(o),!0).forEach(function(t){(0,n.A)(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):A(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}let x=[];const F=function(e){if(27!==e.keyCode)return;if(0===x.length)return;const t=x[x.length-1];let o={};t.dataset.popupCloseStrategy&&(o=JSON.parse(t.dataset.popupCloseStrategy)),o.esc&&B(t)},I=function(){x.forEach(function(e,t){0===t?e.style.removeProperty("--popup-z-index"):e.style.setProperty("--popup-z-index",t)})},B=function(e,t={}){t=M({unmount:!0,reason:"cancel",delay:0},t),setTimeout(function(){let o=e.id.replace("ct-popup-","");if(c().trigger("blocksy:micro-popups:close",o,e),localStorage.setItem("blocksyPastPopups",JSON.stringify(M(M({},(0,i.u)()),{},{[o]:M(M({},(0,i.u)()[o]||{}),{},{pages:[location.href],closed:{reason:t.reason,timestamp:(new Date).getTime()}})}))),function(e){const t=x.indexOf(e);t>-1&&x.splice(t,1),e.style.removeProperty("--popup-z-index"),0===x.length&&document.removeEventListener("keyup",F),I()}(e),e.classList.toggle("active"),setTimeout(function(){const t=e.querySelector(".ct-dynamic-popup-content");t&&t.remove()},500),"no"!==e.dataset.focusTrap&&(f().focusLockOff(),x.length>0)){const e=x[x.length-1];"no"!==e.dataset.focusTrap&&f().focusLockOn(e)}e.dataset.scrollLock&&_().enable(e.querySelector(".entry-content")),[...e.querySelectorAll('iframe[src*="youtu"]')].map(function(e){e.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}',"*")}),[...e.querySelectorAll("video")].map(function(e){e.pause()}),[...e.querySelectorAll('iframe:not([src*="youtu"])')].map(function(e){const t=e.src;e.src="",e.src=t}),e.unmount&&t.unmount&&e.unmount()},t.delay)},J=function(e){const t=e.id.replace("ct-popup-","");c().trigger("blocksy:micro-popups:open",t,e),c().trigger("blocksy:frontend:init"),function(e){const t=0===x.length;x.includes(e)||x.push(e),t&&document.addEventListener("keyup",F),I()}(e),e.classList.add("active"),localStorage.setItem("blocksyPastPopups",JSON.stringify(M(M({},(0,i.u)()),{},{[t]:M(M({},(0,i.u)()[t]||{}),{},{pages:[...((0,i.u)()[t]||{}).pages||[]],closed:null})}))),"no"!==e.dataset.focusTrap&&f().focusLockOn(e),e.dataset.scrollLock&&_().disable(e.querySelector(".entry-content"));let o=e.querySelector(".ct-toggle-close");o&&!o.hasClickListener&&(o.hasClickListener=!0,e.querySelector(".ct-toggle-close").addEventListener("click",function(t){t.preventDefault(),B(e)}));let n={};e.dataset.popupCloseStrategy&&(n=JSON.parse(e.dataset.popupCloseStrategy)),n.backdrop&&("yes"!==e.dataset.popupBackdrop||e.hasClickListener||(e.hasClickListener=!0,e.addEventListener("click",function(t){"yes"===t.target.dataset.popupBackdrop&&(t.preventDefault(),B(e))}))),(n.form_submit||n.button_click)&&q(e,{maybeCloseStrategies:n})};let N=null;const W=function(e,t={}){if(e.classList.contains("active"))B(e);else{if(!e.querySelector(".ct-popup-content")){const o=function(t){const o=document.createElement("div");o.innerHTML=t,o.querySelector(".entry-content")&&(e.querySelector("article").appendChild(o.querySelector(".entry-content")),e.querySelector("article").lastElementChild.classList.add("ct-dynamic-popup-content")),J(e)},n=e.id.replace("ct-popup-",""),r=(0,i.u)()[n],c=e.dataset.cacheKey;if(c&&r&&r.content&&r.content.cacheKey===c)return void o(r.content.content);const s=new FormData;let a=t.postId;if(!a){const e=[...document.body.classList].find(function(e){return 0===e.indexOf("postid-")});e&&(a=e.replace("postid-",""))}return s.append("popup_id",n),a&&s.append("post_id",a),N&&N.abort(),"AbortController"in window&&(N=new AbortController),void fetch(`${ct_localizations.ajax_url}?action=blc_retrieve_popup_content`,{method:"POST",body:s,signal:N.signal}).then(function(e){return e.json()}).then(function({success:e,data:t}){e&&t&&t.content&&(c&&localStorage.setItem("blocksyPastPopups",JSON.stringify(M(M({},(0,i.u)()),{},{[n]:M(M({},(0,i.u)()[n]||{}),{},{content:{content:t.content,cacheKey:c}})}))),o(t.content))})}J(e)}}}}]);